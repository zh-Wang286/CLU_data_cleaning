# 命令行接口 (CLI) 使用说明

本文档详细介绍了 `main.py` 提供的命令行接口，用于运行 CLU 数据清洗与分析系统的各项功能。

## 1. 概览

本工具通过 `click` 库构建，提供了一系列子命令来执行不同的任务。所有命令均以 `python main.py` 作为前缀。

---

## 2. `run-all` 命令

此命令是工具的核心，用于执行完整的端到端分析流程。它会依次进行数据加载、异常点检测、全局聚类审计、意图边界混淆分析，并最终生成所有相关的可视化图表和一份综合审计报告。

### 2.1. 基本用法

```bash
python main.py run-all --input-file <你的数据文件路径>
```

### 2.2. 参数详解

| 参数 | 类型 | 默认值 | 必需 | 描述 |
| :--- | :--- | :--- | :--- | :--- |
| `--input-file` | 文件路径 | N/A | 是 | 指向你的 CLU 项目 JSON 文件的路径 (例如: `data/IT_01_1.json`)。 |
| `--output-dir` | 目录路径 | `outputs` | 否 | 用于存放所有输出结果（报告、图表、缓存）的根目录。 |
| `--min-samples` | 整数 | `15` | 否 | 设定一个意图必须包含的最小语料数。样本量低于此值的意图，将不会被纳入“意图边界混淆分析”和“全局聚类审计”这两项计算中。 |
| `--outlier-threshold` | `90pct` `95pct` 或 `iqr` | `95pct` | 否 | 意图内异常点检测的阈值策略。<br>- `90pct`: 使用90百分位。<br>- `95pct`: 使用95百分位。<br>- `iqr`: 使用标准IQR（四分位距）方法。 |
| `--sort-by` | `p_value` 或 `intent` | `p_value` | 否 | 指定“意图边界混淆分析”报告表格的排序方式。<br>- `p_value`: 按 p-value 从高到低排序，便于快速定位最严重的混淆问题。<br>- `intent`: 按原始意图的字母顺序排序，便于对特定意图进行系统性审查。 |

### 2.3. 使用示例

-   **以最小样本数为 10，并让报告按意图名称排序:**
    ```bash
    python main.py run-all --input-file data/IT_01_1.json --min-samples 10 --sort-by intent
    ```
-   **使用90百分位作为异常点检测阈值:**
    ```bash
    python main.py run-all --input-file data/IT_01_1.json --outlier-threshold 90pct
    ```

---

## 3. `enrich` 命令

此命令用于为样本量不足的意图调用大语言模型 (LLM) 来生成新的候选语料，以扩充数据集。

### 3.1. 基本用法

```bash
python main.py enrich --input-file <你的数据文件路径>
```

### 3.2. 参数详解

| 参数 | 类型 | 默认值 | 必需 | 描述 |
| :--- | :--- | :--- | :--- | :--- |
| `--input-file` | 文件路径 | N/A | 是 | 指向你的 CLU 项目 JSON 文件的路径。 |
| `--output-dir` | 目录路径 | `outputs` | 否 | 用于存放生成的增广报告的根目录。 |
| `--threshold` | 整数 | `25` | 否 | 意图语料数的阈值。样本量低于此值的意图，将会被纳入增广流程。 |
| `--dry-run` | 布尔标志 | `False` | 否 | 如果设置此标志，生成的候选语料将直接打印在控制台，而不会生成 Markdown 报告文件。 |

### 3.3. 使用示例

-   **直接在控制台预览为样本数少于 30 的意图生成的候选语料:**
    ```bash
    python main.py enrich --input-file data/IT_01_1.json --threshold 30 --dry-run
    ```

## 4. 局部意图对比分析 (`compare-intents`)

此命令针对您指定的2个或多个意图，运行一次局部的、高精度的边界混淆分析。

它专门用于深入研究那些在全局分析中发现的、可能存在定义重叠的意图对。与全局分析（`run-all`）不同，此命令的输出（报告和散点图）将只包含您指定的意图，从而提供一个更清晰、更聚焦的视图。

**核心优势**:
-   **聚焦分析**: 排除无关意图的干扰，让您可以专注于辨析特定意图间的边界问题。
-   **全局一致性**: 分析是在与 `run-all` 命令相同的全局向量空间（经过全局PCA降维）中进行的，确保了结果的可比性和一致性。

### 4.1. 参数

-   `--input-file` 或 `-i` (**必需**): CLU 项目的 JSON 文件路径。
-   `--target-intents` 或 `-t` (**必需**, 可多次使用): 指定要对比分析的意图名称。每次使用此选项指定一个意图，至少需要指定两个。
-   `--output-dir` 或 `-o` (可选): 指定报告和图表的输出目录。如果未指定，会自动在 `outputs/` 目录下创建一个带时间戳和意图名称的描述性文件夹。
-   `--min-samples` 或 `-m` (可选): 意图构建统计模型所需的最小语料数（默认为15）。
-   `--sort-by` (可选): 报告中边界混淆语料的排序方式，可选值为 `p_value` (默认) 或 `intent`。

### 4.2. 示例

假设您想深入分析 "意图A" 和 "意图B" 之间的关系：

```bash
python main.py compare-intents -i data/clu_project.json -t "意图A" -t "意图B"
```

如果您想对比三个意图，并指定输出目录：

```bash
python main.py compare-intents \
  -i data/clu_project.json \
  -t "意图A" \
  -t "意图B" \
  -t "意图C" \
  -o outputs/my_comparison
```
